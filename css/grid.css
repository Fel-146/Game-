/* css/grid.css - FINAL VERSION (UPDATED WITH ARMOR BAR) */

/* --- KHUNG B√ÄN C·ªú --- */
.grid-12x12 {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    grid-template-rows: repeat(12, 1fr);
    gap: 2px;
    width: 600px;
    height: 600px;
    background-color: #333;
    border: 4px solid #444;
    /* NgƒÉn b√†n c·ªù b·ªã co gi√£n */
    flex-shrink: 0; 
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    position: relative; /* M·ªëc t·ªça ƒë·ªô cho c√°c hi·ªáu ·ª©ng bay */
}

/* --- √î ƒê·∫§T (S√ÄN NH√Ä) --- */
.grid-cell {
    /* Texture n·ªÅn g·∫°ch t·ªëi */
    background-image: url('https://www.transparenttextures.com/patterns/dark-matter.png');
    background-color: #555; 
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden; /* C·∫Øt b·ªè ph·∫ßn th·ª´a */
    border: 1px solid #444;
}

.grid-cell:hover {
    filter: brightness(1.3); /* S√°ng l√™n khi di chu·ªôt */
    z-index: 2; /* N·ªïi l√™n tr√™n */
    border-color: #aaa;
}

/* --- √î T∆Ø·ªúNG (WALL) --- */
.cell-wall {
    background-color: #2c3e50;
    /* Texture g·∫°ch t∆∞·ªùng */
    background-image: url('https://www.transparenttextures.com/patterns/brick-wall-dark.png');
    background-size: cover;
    box-shadow: inset 0 0 15px #000;
}

/* --- NG∆Ø·ªúI CH∆†I (PLAYER TOKEN) --- */
.player-token {
    position: relative; 
    width: 85%;  
    height: 85%;
    border-radius: 50%;
    
    z-index: 10; /* N·∫±m ƒë√® l√™n Item */
    
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.6);
    transition: transform 0.2s;
    border: 2px solid transparent; /* Vi·ªÅn ƒë·ªÉ JS g√°n m√†u team */
}

/* ·∫¢nh Avatar b√™n trong token */
.player-token img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    display: block;
}

/* --- THANH CH·ªà S·ªê MINI TR√äN ƒê·∫¶U TOKEN (M·ªöI) --- */
.token-stat-container {
    position: absolute;
    top: 2px;           /* C√°ch m√©p tr√™n 2px */
    left: 4px;          
    right: 4px;
    display: flex;
    flex-direction: column; /* X·∫øp ch·ªìng d·ªçc */
    gap: 1px;           /* Kho·∫£ng c√°ch gi·ªØa thanh M√°u v√† Gi√°p */
    z-index: 12;        /* N·∫±m tr√™n ·∫£nh nh√¢n v·∫≠t */
    pointer-events: none; /* B·∫•m xuy√™n qua */
}

.mini-bar-bg {
    width: 100%;
    height: 2px;        /* Chi·ªÅu cao thanh (r·∫•t m·∫£nh) */
    background-color: rgba(0, 0, 0, 0.7); /* N·ªÅn ƒëen m·ªù */
    border-radius: 2px;
    overflow: hidden;
    border: 0.5px solid rgba(255,255,255,0.2);
}

.mini-bar-fill {
    height: 100%;
    transition: width 0.3s ease;
}

/* M√†u s·∫Øc c√°c thanh */
.fill-hp { background-color: #2ecc71; }    /* Xanh l√° */
.fill-hp.low { background-color: #e74c3c; } /* ƒê·ªè khi m√°u th·∫•p */
.fill-armor { background-color: #3498db; } /* Xanh d∆∞∆°ng */


/* --- ITEM TR√äN B·∫¢N ƒê·ªí --- */
.item-img-on-map {
    position: absolute; 
    top: 0; left: 0; right: 0; bottom: 0;
    margin: auto; 
    
    width: 65%; 
    height: 65%;
    object-fit: contain;
    
    z-index: 1; /* N·∫±m d∆∞·ªõi c√πng */
    
    animation: floatItem 2s ease-in-out infinite;
    filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
    pointer-events: none; 
}

/* Hi·ªáu ·ª©ng H√≤m Ti·∫øp T·∫ø ph√°t s√°ng */
.crate-glow {
    filter: drop-shadow(0 0 8px #f1c40f);
    width: 80%;
    height: 80%;
}

@keyframes floatItem {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-4px); }
}

/* --- HIGHLIGHT DI CHUY·ªÇN --- */
.highlight-move {
    background-color: rgba(52, 152, 219, 0.4) !important;
    box-shadow: inset 0 0 15px #3498db;
    cursor: pointer;
    animation: pulseBlue 1.5s infinite;
}

@keyframes pulseBlue {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}

/* --- HIGHLIGHT T·∫§N C√îNG (H∆Ø·ªöNG) --- */
.highlight-attack-dir {
    background-color: rgba(230, 126, 34, 0.5) !important;
    box-shadow: inset 0 0 15px #d35400;
    cursor: crosshair;
    animation: pulseOrange 0.8s infinite;
}

.highlight-attack-dir::after {
    content: 'üéØ';
    font-size: 1.5rem;
    opacity: 0.8;
    
    /* FIX L·ªñI BI·∫æN D·∫†NG: ƒê∆∞a ra kh·ªèi lu·ªìng Flexbox */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 5; /* N·∫±m tr√™n n·ªÅn nh∆∞ng d∆∞·ªõi nh√¢n v·∫≠t n·∫øu c·∫ßn */
}

@keyframes pulseOrange {
    0% { transform: scale(0.95); opacity: 0.7; }
    50% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(0.95); opacity: 0.7; }
}

/* --- HI·ªÜU ·ª®NG ƒê·∫†N --- */
.bullet-trail {
    position: absolute;
    height: 4px;
    background: linear-gradient(90deg, rgba(255,200,0,0) 0%, rgba(255,215,0,1) 50%, #fff 100%);
    z-index: 100;
    pointer-events: none;
    transform-origin: left center;
    border-radius: 2px;
    box-shadow: 0 0 10px rgba(255, 165, 0, 0.9);
    opacity: 1;
    transition: opacity 0.5s ease-out;
}

/* --- H·ªÜ TH·ªêNG FLOATING TEXT --- */
.floating-text {
    position: fixed; /* B·∫Øt bu·ªôc ƒë·ªÉ bay tr√™n body */
    pointer-events: none;
    z-index: 10000; /* ƒê·∫£m b·∫£o n·∫±m tr√™n c√πng */
    
    /* --- LOGIC CƒÇN CH·ªàNH TH·∫®M Mƒ® --- */
    /* 1. CƒÉn gi·ªØa d√≤ng ch·ªØ v√†o ƒë√∫ng to·∫° ƒë·ªô ƒë∆∞·ª£c giao */
    transform: translate(-50%, -50%);
    
    /* 2. Cho ph√©p ch·ªØ d√†i ra, nh∆∞ng gi·ªõi h·∫°n kh√¥ng qu√° r·ªông */
    width: max-content;      /* Chi·ªÅu r·ªông √¥m s√°t n·ªôi dung ch·ªØ */
    max-width: 200px;        /* N·∫øu d√†i h∆°n 200px th√¨ m·ªõi xu·ªëng d√≤ng */
    
    /* 3. CƒÉn gi·ªØa vƒÉn b·∫£n */
    text-align: center;
    white-space: normal;     /* Cho ph√©p xu·ªëng d√≤ng t·ª± nhi√™n */
    font-weight: bold;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.8); /* Vi·ªÅn ƒëen gi√∫p ch·ªØ n·ªïi b·∫≠t */
    
    /* Animation bay l√™n */
    animation: floatUpFade 1.5s forwards;
}

.text-damage { color: #e74c3c; font-size: 1.5rem; }
.text-heal { color: #2ecc71; }
.text-miss { color: #95a5a6; font-style: italic; }
.text-info { color: #f1c40f; font-size: 1rem; }
.text-crit { color: #ff9f43; font-size: 1.8rem; transform: scale(1.2); }

@keyframes floatUpFade {
    0% { transform: translateY(0) scale(1); opacity: 1; }
    100% { transform: translateY(-40px) scale(1); opacity: 0; }
}

/* --- ICON T√öI ƒê·ªí (INVENTORY) --- */
.inv-item .icon {
    width: 60px;
    height: 60px;
    background-color: #2c3e50; 
    border: 2px solid #95a5a6; 
    border-radius: 8px; 
    display: flex; 
    justify-content: center; 
    align-items: center; 
    overflow: hidden; 
    flex-shrink: 0; 
    font-size: 30px; 
}

.inv-item .icon img {
    width: 100%;
    height: 100%;
    object-fit: contain; 
    padding: 5px; 
    display: block;
}

/* --- M√ÄU PH·∫®M CH·∫§T (Floating Text) --- */
.text-rarity-common { color: #fff; font-weight: bold; text-shadow: 1px 1px 0 #000; }
.text-rarity-rare { color: #3498db; font-weight: bold; text-shadow: 1px 1px 0 #000; }
.text-rarity-epic { color: #9b59b6; font-weight: bold; text-shadow: 1px 1px 0 #000; }
.text-rarity-legendary { color: #e67e22; font-weight: 900; text-transform: uppercase; text-shadow: 0 0 10px gold; }

.powerup-item {
    position: absolute;
    z-index: 2;
    width: 70%;  /* ·∫¢nh chi·∫øm 70% √¥ */
    height: 70%;
    object-fit: contain; /* Gi·ªØ t·ª∑ l·ªá ·∫£nh kh√¥ng b·ªã m√©o */
    
    /* CƒÉn gi·ªØa */
    top: 15%;
    left: 15%;
    
    /* Hi·ªáu ·ª©ng bay & b√≥ng ƒë·ªï */
    filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
    animation: floatItem 2s infinite ease-in-out;
    pointer-events: none; /* ƒê·ªÉ click xuy√™n qua v√†o √¥ ƒë·∫•t */
}

@keyframes floatItem {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

/* M√†u ch·ªØ th√¥ng b√°o (Th√™m m√†u cho Speed) */
.text-speed { 
    color: #00d2d3; /* M√†u xanh cyan */
    font-weight: bold; 
    font-size: 1.2rem;
    text-shadow: 1px 1px 0 #000;
}

/* --- TH√äM V√ÄO CU·ªêI FILE css/grid.css --- */

/* Highlight t·∫ßm n√©m */
.highlight-throw {
    box-shadow: inset 0 0 15px rgba(230, 126, 34, 0.6); /* M√†u cam */
    cursor: crosshair;
}

/* Hi·ªáu ·ª©ng n·ªï (M√†u s·∫Øc s·∫Ω ƒë∆∞·ª£c g√°n ƒë·ªông b·∫±ng JS) */
.explosion-flash {
    animation: flashAnim 0.5s ease-out forwards;
    pointer-events: none; /* ƒê·ªÉ kh√¥ng ch·∫∑n click */
}

@keyframes flashAnim {
    0% { opacity: 0.8; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.1); }
    100% { opacity: 0; transform: scale(1); }
}

/* --- CH·∫æ ƒê·ªò MOBILE (RESPONSIVE) --- */

/* 1. Thay ƒë·ªïi layout m√†n h√¨nh game th√†nh c·ªôt d·ªçc */
.mode-mobile {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    padding-bottom: 50px; /* Ch·ª´a ch·ªó cho scroll */
}

/* ·∫®n b·ªõt c√°c panel b√™n c·∫°nh ho·∫∑c x·∫øp ch√∫ng xu·ªëng d∆∞·ªõi */
.mode-mobile .left-panel, 
.mode-mobile .right-panel {
    width: 95%; /* Chi·∫øm full chi·ªÅu ngang m√†n h√¨nh ƒët */
    margin-bottom: 10px;
    order: 2; /* ƒê·∫©y xu·ªëng d∆∞·ªõi b√†n c·ªù */
}

/* ƒê∆∞a b√†n c·ªù l√™n ƒë·∫ßu */
.mode-mobile #game-board-container {
    order: 1;
    margin-bottom: 15px;
}

/* 2. Thu nh·ªè b√†n c·ªù */
.board-mobile {
    /* Thay v√¨ c·ªë ƒë·ªãnh 600px, ta d√πng ƒë∆°n v·ªã t∆∞∆°ng ƒë·ªëi */
    width: 95vw !important;  /* 95% chi·ªÅu r·ªông m√†n h√¨nh */
    height: 95vw !important; /* Vu√¥ng v·ª©c theo chi·ªÅu r·ªông */
    max-width: 400px;        /* Kh√¥ng to qu√° 400px */
    max-height: 400px;
}

/* 3. ƒêi·ªÅu ch·ªânh √¥ Grid trong mobile */
.board-mobile .grid-cell {
    border-width: 1px; /* Vi·ªÅn m·ªèng l·∫°i */
}

/* Icon nh√¢n v·∫≠t/v·∫≠t ph·∫©m nh·ªè l·∫°i */
.board-mobile .player-token,
.board-mobile .item-token,
.board-mobile .crate-token {
    width: 80% !important;
    height: 80% !important;
    font-size: 1.2rem; /* Gi·∫£m c·ª° ch·ªØ icon */
}

/* Hi·ªáu ·ª©ng n·ªï nh·ªè l·∫°i */
.board-mobile .explosion-flash {
    width: 100% !important;
    height: 100% !important;
}